<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style/bootstrap.css" />
    <link rel="stylesheet" href="/style/style.css" />
    <!-- LÄGG DIN EGNA STYLESHEET I STYLE.CSS-->

    <link rel="stylesheet" href="cartStyle/cartStylish.css" />

    <!-- Nedan script är nödvändigt för plus/minus knappar -->
    <script src="https://code.jquery.com/jquery-2.2.4.js" charset="utf-8"></script>
    <script src=https://unpkg.com/ionicons@5.4.0/dist/ionicons.js></script>

    <title>Hakim Livs</title>
</head>

<body>
    <!-- Navbar -->
    <div id="nav-placeholder">


    </div>

    <!--Sidebar-->

    <div class="d-flex wrapper">
        <div id="sidebar-container" class="sidebar-expanded d-none d-md-block">
            <div class="border-right" id="sidebar-wrapper">

            </div>
        </div>
        <div class="container">

            <div class="d-flex w-100 justify-content-start align-items-center">
                <div class="container" id="inputorder">

                    <div class="container" style="margin-top: 7rem;">

                    </div>

                    <!-- LÄGG IN ALLT JS Generat -->

                    <div class="row mt-sm-5 justify-content-center ">
                        <h1>Varukorg</h1>
                    </div>

                    <div id="totalCartPrice">Totalpris: </div>
                    <button onclick="location.href='checkout.html'" class="btn btn-primary"
                        type="button">Checkout</button>

                    <div id="inputorder" class="row justify-content-center shopping-cart mt-5 ">

                        <!-- Product -->

                    </div>
                    <!-- SLUTA LÄGGA IN HÄR -->

                </div>

            </div>

            <!-- Footer -->
            <footer id="foot" style="background-color: #007A3D;">

            </footer>
        </div>
            <script>

                var globalData;
                //SKRIV IN DIN JAVASCRIPT KOD HÄR
                $(function () {
                    $("#nav-placeholder").load("../nav.html");
                    $("#sidebar-wrapper").load("../sidebar.html");
                    $("#foot").load("../footer.html");
                });

                var maincart = new Array();

                var productcartparse = localStorage.getItem('cloudcart');
                var productcart = JSON.parse(productcartparse);



if(!productcart.length == 0){
  maincart = productcart;
}

                console.log(productcart)
                if (!productcart.length == 0) {
                    maincart = productcart;
                }



                fetch("/testdata/testprodukt.json")
                    .then((response) => response.json())
                    .then((data) => cardGen(data));

                const cardGen = (response) => {

                    globalData = response;



                    var generateItem = false;
                    var totalPriceAllItems = 0;
                    var lastId = 0;
                    var totalPriceSingleItem = 0;
                    var amountSingleItem = 0;

                    response.forEach(responseElement => {
                        maincart.forEach(maincartElement => {
                            if (maincartElement == responseElement.productid) {
                                totalPriceAllItems += responseElement.price;
                                generateItem = true;
                                if (lastId == maincartElement) {
                                    amountSingleItem++;
                                } else {
                                    lastId = maincartElement;
                                    amountSingleItem++;
                                }
                            }
                            if (!amountSingleItem == 0) {
                                totalPriceSingleItem = maincartElement.price * amountSingleItem;
                            } else {
                                totalPriceSingleItem = maincartElement.price;
                            }
                        })
                        if (generateItem) {
                            document.getElementById("inputorder").innerHTML += `
        
        
                                <div id="${responseElement.productid}" class="row d-flex flex-wrap justify-content-start itemCart mt-2">
                                
                                
                                <div class="col col-lg-1 buttonsCart justify-content-center  ">
                                    <img src="cartImages/delete-icn.svg" alt="" >
                                </div>

                                <div class="col-sm-2 col-lg-2 imageCart  mr-5 ml-5">
                                    <img src="${responseElement.image}" height="150px" class = "responsive" alt="product image" />
                                </div>

                                <div class="col-sm-3 col-lg-2 descriptionCart justify-content-center mt-4 mr-5 ml-5 ">
                                    <span class="row ">${responseElement.name}</span>
                                    
                                </div>

                                <div class="row quantityCart ml-5 mr-5">
                              
                                    <div class="row mt-5">
                                      <div class="col-3">
                                        <button onclick="minusItem(${responseElement.productid})" class="minus-btnCart " type="button" name="button">
                                            <img src="cartImages/minus.svg" alt="">
                                        </button>
                                      </div>
                                      <div class="col-3 justify-content-center" style="padding-left: 15px; padding-right: 1px; padding-top: 1px; padding-bottom: 2px;">
                                        <input disabled id="field${responseElement.productid}" class = "" style="width: 2rem;" type="text"  name="name" value="${amountSingleItem}">
                                      </div>
                                      <div class="col-3">
                                        <button onclick="plusItem(${responseElement.productid})" class="plus-btnCart " type="button" name="button">
                                            <img src="cartImages/plus.svg" alt="" >
                                        </button>                                      </div>
                                    </div>
                                </div>
                             

                                <div class="col col-lg-2total-priceCart  mt-5  mr-1 ml-1">${responseElement.price} kr</div>

                            </div>
          `;
                        }

                        totalPriceSingleItem = 0;
                        generateItem = false;
                        amountSingleItem = 0;

                    });

                    var priceAll = document.getElementById("totalCartPrice");
                    priceAll.innerHTML += ` ${totalPriceAllItems} kr`;
                };

                function minusItem(buttonid) {

                    var buttonName = "field" + buttonid;

                    var positionInArray = 0;

                    if (document.getElementById(buttonName).value > 0) {

                        for (i = 0; i < maincart.length; i++) {
                            if (maincart[i] == buttonid) {
                                positionInArray = i;
                                break;
                            }
                        }

                        maincart.splice(positionInArray, 1);

                        var amountInArrayCounter = 0;

                        for (i = 0; i < maincart.length; i++) {
                            if (maincart[i] == buttonid) {
                                amountInArrayCounter++;
                            }
                        }


                        document.getElementById(buttonName).setAttribute('value', amountInArrayCounter);

                        lowerPrice(globalData);

                        if (amountInArrayCounter == 0) {
                            var el = document.getElementById(buttonid);
                            el.remove();

                        }



                        shoppingcart.innerHTML = `<ion-icon name="cart-outline"></ion-icon>Till kassa ${maincart.length} produkter`;


                        amountInArrayCounter = 0;
                    }


                }


                function lowerPrice(data) {
                    var totalPriceInCart = 0;
                    for (i = 0; i < maincart.length; i++) {
                        for (y = 0; y < data.length; y++) {
                            if (maincart[i] == data[y].productid) {
                                totalPriceInCart += data[y].price;
                            }

                        }

                    }

                    document.getElementById("totalCartPrice").innerHTML = `Totalpris: ${totalPriceInCart} kr`;

                    localStorage.setItem('cloudcart', JSON.stringify(maincart));
                }





                function plusItem(buttonid) {

                    var buttonName = "field" + buttonid;

                    var positionInArray = 0;


                    maincart.push(buttonid);

                    var amountInArrayCounter = 0;

                    for (i = 0; i < maincart.length; i++) {
                        if (maincart[i] == buttonid) {
                            amountInArrayCounter++;
                        }
                    }


                    document.getElementById(buttonName).setAttribute('value', amountInArrayCounter);




                    higherPrice(globalData);



                    shoppingcart.innerHTML = `<ion-icon name="cart-outline"></ion-icon>Till kassa ${maincart.length} produkter`;


                    amountInArrayCounter = 0;


                }

                function higherPrice(data) {
                    var totalPriceInCart = 0;
                    for (i = 0; i < maincart.length; i++) {
                        for (y = 0; y < data.length; y++) {
                            if (maincart[i] == data[y].productid) {
                                totalPriceInCart += data[y].price;
                            }
                        }

                    }

                    document.getElementById("totalCartPrice").innerHTML = `Totalpris: ${totalPriceInCart} kr`;

                    localStorage.setItem('cloudcart', JSON.stringify(maincart));
                }






//SLUTA SKRIV IN DIN JAVASCRIPT KOD HÄR
            </script>

            <script src="https://code.jquery.com/jquery-3.6.0.js"
                integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</body>

</html>